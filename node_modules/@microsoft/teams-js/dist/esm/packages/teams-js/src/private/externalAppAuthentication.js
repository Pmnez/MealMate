import{sendMessageToParentAsync as e,callFunctionInHost as t,callFunctionInHostAndHandleResponse as n}from"../internal/communication.js";import{ensureInitialized as i}from"../internal/internalAPIs.js";import{ResponseHandler as r}from"../internal/responseHandler.js";import{getApiVersionTag as o}from"../internal/telemetry.js";import{isPrimitiveOrPlainObject as a,validateId as s,validateUrl as u}from"../internal/utils.js";import{FrameContexts as c,errorNotSupportedOnPlatform as h}from"../public/constants.js";import{runtime as l}from"../public/runtime.js";import{AppId as p}from"../public/appId.js";const d="v2";class f{constructor(e){this.invokeRequest=e}serialize(){return this.invokeRequest}}function m(e){const t=e;return t.responseType===w.ActionExecuteInvokeResponse&&void 0!==t.value&&void 0!==t.statusCode&&void 0!==t.type}const A="Action.Execute";var I,w,v,x;!function(e){e.ActionExecuteInvokeRequest="ActionExecuteInvokeRequest",e.QueryMessageExtensionRequest="QueryMessageExtensionRequest"}(I||(I={})),function(e){e.ActionExecuteInvokeResponse="ActionExecuteInvokeResponse",e.QueryMessageExtensionResponse="QueryMessageExtensionResponse"}(w||(w={}));class R extends r{validate(e){return m(e)}deserialize(e){return e}}function g(e){if("object"!=typeof e||null===e)return!1;const t=e;return Object.values(v).includes(t.errorCode)&&(void 0===t.message||"string"==typeof t.message)}function E(e){e.requestType===I.ActionExecuteInvokeRequest?y(e):e.requestType===I.QueryMessageExtensionRequest&&function(e){if(e.commandId.length>64)throw new Error("originalRequestInfo.commandId exceeds the maximum size of 64 characters");if(e.parameters.length>5)throw new Error("originalRequestInfo.parameters exceeds the maximum size of 5");for(const t of e.parameters){if(t.name.length>64)throw new Error("originalRequestInfo.parameters.name exceeds the maximum size of 64 characters");if(t.value.length>512)throw new Error("originalRequestInfo.parameters.value exceeds the maximum size of 512 characters")}}(e)}function y(e){if(e.type!==A){throw{errorCode:v.INTERNAL_ERROR,message:`Invalid action type ${e.type}. Action type must be "${A}"`}}if(!a(e.data)){throw{errorCode:v.INTERNAL_ERROR,message:`Invalid data type ${typeof e.data}. Data must be a primitive or a plain object.`}}}function q(t,n,r){if(i(l,c.content),!k())throw h;const a=new p(t);return E(r),e(o(d,"externalAppAuthentication.authenticateAndResendRequest"),"externalAppAuthentication.authenticateAndResendRequest",[a.toString(),r,n.url.href,n.width,n.height,n.isExternal]).then((([e,t])=>{if(e&&null!=t.responseType)return t;throw t}))}function C(t,n){if(i(l,c.content),!k())throw h;const r=new p(t);return e(o(d,"externalAppAuthentication.authenticateWithSSO"),"externalAppAuthentication.authenticateWithSSO",[r.toString(),n.claims,n.silent]).then((([e,t])=>{if(!e)throw t}))}function S(t,n,r){if(i(l,c.content),!k())throw h;const a=new p(t);return E(r),e(o(d,"externalAppAuthentication.authenticateWithSSOAndResendRequest"),"externalAppAuthentication.authenticateWithSSOAndResendRequest",[a.toString(),r,n.claims,n.silent]).then((([e,t])=>{if(e&&null!=t.responseType)return t;throw t}))}function j(t,n,r){if(i(l,c.content),!k())throw h;return s(t,new Error("titleId is Invalid.")),s(n,new Error("oauthConfigId is Invalid.")),e(o(d,"externalAppAuthentication.authenticateWithOauth2"),"externalAppAuthentication.authenticateWithOauth2",[t,n,r.width,r.height,r.isExternal]).then((([e,t])=>{if(!e)throw t}))}function O(t,n,r){if(i(l,c.content),!k())throw h;return s(t,new Error("titleId is Invalid.")),n&&u(n),e(o(d,"externalAppAuthentication.authenticateWithPowerPlatformConnectorPlugins"),"externalAppAuthentication.authenticateWithPowerPlatformConnectorPlugins",[t,null==n?void 0:n.toString(),null==r?void 0:r.width,null==r?void 0:r.height,null==r?void 0:r.isExternal]).then((([e,t])=>{if(!e)throw t}))}!function(e){e.INTERNAL_ERROR="INTERNAL_ERROR"}(v||(v={}));class P{constructor(e){this.param=e}serialize(){var e,t,n;return{connectorId:this.param.connectorId,oAuthConfigId:this.param.oAuthConfigId,traceId:null!==(n=null===(t=null===(e=this.param.traceId)||void 0===e?void 0:e.toString)||void 0===t?void 0:t.call(e))&&void 0!==n?n:this.param.traceId,windowParameters:this.param.windowParameters?Object.assign({},this.param.windowParameters):void 0}}}function W(e){if(i(l,c.content),!k())throw h;return s(e.connectorId,new Error("connectorId is Invalid.")),s(e.oAuthConfigId,new Error("oauthConfigId is Invalid.")),t("externalAppAuthentication.authenticateWithConnector",[new P(e)],o(d,"externalAppAuthentication.authenticateWithConnector"),g)}!function(e){e.Invalid="Invalid",e.Valid="Valid",e.Expired="Expired"}(x||(x={}));class b extends r{validate(e){return"string"==typeof e&&e in x}deserialize(e){return e}}function T(e){if(i(l,c.content),!k())throw h;return s(e.connectorId,new Error("connectorId is Invalid.")),s(e.oAuthConfigId,new Error("oAuthConfigId is Invalid.")),n("externalAppAuthentication.getUserAuthenticationStateForConnector",[new P(e)],new b,o(d,"externalAppAuthentication.getUserAuthenticationStateForConnector"),g)}function k(){return!(!i(l)||!l.supports.externalAppAuthentication)}export{A as ActionExecuteInvokeRequestType,R as ActionExecuteResponseHandler,v as InvokeErrorCode,w as InvokeResponseType,I as OriginalRequestType,f as SerializableActionExecuteInvokeRequest,P as SerializableConnectorParameters,x as UserAuthenticationState,q as authenticateAndResendRequest,W as authenticateWithConnector,j as authenticateWithOauth2,O as authenticateWithPowerPlatformConnectorPlugins,C as authenticateWithSSO,S as authenticateWithSSOAndResendRequest,T as getUserAuthenticationStateForConnector,m as isActionExecuteResponse,g as isInvokeError,k as isSupported,y as validateActionExecuteInvokeRequest};
